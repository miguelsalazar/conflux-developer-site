<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">Internal Contract | Conflux</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Internal Contract | Conflux"><meta data-react-helmet="true" name="description" content="- AdminControl contract"><meta data-react-helmet="true" property="og:description" content="- AdminControl contract"><meta data-react-helmet="true" name="keywords" content="conflux,contract"><meta data-react-helmet="true" property="og:url" content="https://developer.conflux-chain.org/docs/conflux-rust/internal_contract/internal_contract"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://developer.conflux-chain.org/docs/conflux-rust/internal_contract/internal_contract"><link rel="stylesheet" href="/styles.72ea3a70.css">
<link rel="preload" href="/styles.3cee6932.js" as="script">
<link rel="preload" href="/runtime~main.3c1408f1.js" as="script">
<link rel="preload" href="/main.258f3ebe.js" as="script">
<link rel="preload" href="/1.5ccf34a3.js" as="script">
<link rel="preload" href="/2.19bdff5a.js" as="script">
<link rel="preload" href="/69.c9038b7d.js" as="script">
<link rel="preload" href="/76.bd9a6ce5.js" as="script">
<link rel="preload" href="/20ac7829.f718cc52.js" as="script">
<link rel="preload" href="/73.5e6ca28b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Conflux-Chain/conflux-developer-site" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_KVdu"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_13On moon_3n_g"></span></div><div class="react-toggle-track-x"><span class="toggle_13On sun_UemI"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/Conflux-Chain/conflux-developer-site" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_3T5V"><div class="docSidebarContainer_1y9o"><div class="sidebar_mAK4"><div class="menu menu--responsive menu_1wyc"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_XNDY" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="#!">Learn About Conflux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/introduction/en/conflux_overview">Conflux Overview</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">Try Conflux</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/get_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/send_transaction">My First Transaction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/independent_chain">Run an Independent Chain</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/conflux-rust/internal_contract/internal_contract">Internal Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/light_node">Run a Light Node</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/json_rpc">JSON RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/pubsub">Publish-Subscribe API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-doc/docs/cli_sub_commands">CLI Sub-commands</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/js-conflux-sdk/docs/javascript_sdk">Javascript SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/go-conflux-sdk/go_sdk">Golang SDK</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="#!">ConfluxPortal</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/introduction">What Is ConfluxPortal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/Main_Concepts/getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/Main_Concepts/accessing_accounts">Accessing Accounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/Main_Concepts/sending_transactions">Sending Transactions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/API_Reference/provider_api">Portal Provider API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/conflux-portal/docs/en/portal/API_Reference/signing_data_with_portal">Signing Data with ConfluxPortal</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2yiU"><div class="container padding-vert--lg docItemWrapper_182k"><div class="row"><div class="col docItemCol_2uRP"><div class="docItemContainer_1gVo"><article><header><h1 class="docTitle_3r6L">Internal Contract</h1></header><div class="markdown"><ul><li><a href="#admincontrol-contract">AdminControl contract</a><ul><li><a href="#overview">Overview</a></li><li><a href="#examples">Examples</a></li></ul></li><li><a href="#sponsorwhitelistcontrol-contract">SponsorWhitelistControl contract</a><ul><li><a href="#overview-1">Overview</a></li><li><a href="#sponsorship-replacement">Sponsorship Replacement</a></li><li><a href="#add-sponsor-balance">Add Sponsor Balance</a></li><li><a href="#whitelist-maintenance">Whitelist maintenance</a></li><li><a href="#examples-1">Examples</a></li></ul></li><li><a href="#staking-contract">Staking Contract</a><ul><li><a href="#overview-2">Overview</a></li><li><a href="#interest-rate">Interest Rate</a></li><li><a href="#locking-and-voting-power">Locking and Voting Power</a></li><li><a href="#examples-2">Examples</a></li></ul></li></ul><p>(<strong>IMPORTANT: the interfaces are changed in Tethys mainnet. This document is synced with the newest version.</strong>)</p><p>Conflux introduces several built-in internal contracts for better system maintenance and on-chain governance. Now Conflux has three internal contracts: <code>AdminControl</code> contract, <code>SponsorWhitelistControl</code> contract and <code>Staking</code> contract. These contracts provide solidity function apis defined <a href="https://github.com/Conflux-Chain/conflux-rust/tree/master/internal_contract/contracts" target="_blank" rel="noopener noreferrer">here</a>. These function can only be called via <code>CALL</code> or <code>STATICCALL</code> operation. Using operation <code>CALLCODE</code> or <code>DELEGATECALL</code> to interact with internal contracts will trigger an error.</p><p>The addresses of these three internal contracts are list as follows:</p><ul><li>AdminControl: <code>0x0888000000000000000000000000000000000000</code></li><li>SponsorWhitelistControl: <code>0x0888000000000000000000000000000000000001</code></li><li>Staking: <code>0x0888000000000000000000000000000000000002</code></li></ul><p>All the example code in this document will use <a href="https://github.com/Conflux-Chain/js-conflux-sdk" target="_blank" rel="noopener noreferrer">js-conflux-sdk</a>. The solidity function apis are list <a href="https://github.com/Conflux-Chain/conflux-rust/tree/master/internal_contract/contracts" target="_blank" rel="noopener noreferrer">here</a>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="admincontrol-contract"></a>AdminControl contract<a aria-hidden="true" tabindex="-1" class="hash-link" href="#admincontrol-contract" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="overview"></a>Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>The <code>AdminControl</code> contract is a debug tool for contract development. When a contract is created during a transaction, the sender for the current transaction will become the contract admin automatically.</p><p>The <code>admin</code> address can transfer the administrator rights to another <strong>normal address</strong> or <strong>zero address</strong> by calling interface <code>setAdmin(address contractAddr, address newAdmin)</code>. A contract can never be an admin. </p><p>The admin of a contract has several administrator rights. It can call interface <code>destroy(address contractAddr)</code> to destroy contract, just like a contract calling <code>suicide()</code> function. The SponsorWhitelist internal contract provides some functions can only be called by admin address. These functions can update the whitelist in sponsor mechanism. They will be introduced later. </p><p><strong>Note: For all the interfaces requiring administrator rights, no matter the execution success or not, no error or exception will be triggered during internal contract execution.</strong> For example, if a non-admin address tries to transfer the admin address to itself, this transaction will success but nothing will be changed. </p><p>ConfluxScan may mark a contract as debug mode if the contract has non-zero admin address. <strong>So remember, if you think the contract is ready for production environment, you should set admin address to zero.</strong></p><p>The <code>AdminControl</code> contract also provides a query interface <code>getAdmin(address contractAddr)</code> which can be called by anyone. </p><p><strong>Corner cases:</strong></p><ol><li>The admin is set at the start of contract creation. So if sender <code>A</code> creates contract <code>B</code> and set admin to <code>C</code> during contract construction, the admin will be <code>C</code> when the contract is deployed. </li><li>However, if sender <code>A</code> calls contract <code>B</code>, then contract <code>B</code> creates contract <code>C</code> and then set admin to <code>D</code> during contract contraction, then the set will fail because the admin of <code>C</code> is <code>A</code> and the sender for creating <code>C</code> is <code>B</code>. </li><li>But, Conflux introduces a special policy. In case 2, if <code>D</code> is zero address, the set admin will success. This means that a contract can declare &quot;I don&#x27;t need admin&quot; during contract creation. </li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h2><p>Consider you have deployed a contract whose address is <code>contract_addr</code>. The administrator can call <code>AdminControl.setAdmin(contract_addr, new_admin)</code> to change the administrator and call <code>AdminControl.destroy(contract_addr)</code> to kill the contract. </p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://test.confluxrpc.org&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">wallet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addPrivateKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> admin_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">InternalContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AdminControl&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to change administrator</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setAdmin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> new_admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to kill the contract</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">admin_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">destroy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="sponsorwhitelistcontrol-contract"></a>SponsorWhitelistControl contract<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sponsorwhitelistcontrol-contract" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="overview-1"></a>Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview-1" title="Direct link to heading">#</a></h2><p>Conflux implements a sponsorship mechanism to subsidize the usage of smart contracts. Thus, a new account with zero balance is able to call smart contracts as long as the execution is sponsored (usually by the operator of Dapps). The built-in SponsorControl contract is introduced to record the sponsorship information of smart contracts. </p><p>When a message call happens, Conflux does not check sponsorship again. For example, if normal address <code>A</code> calls contract <code>B</code> and contract <code>B</code> calls contract <code>C</code>, Conflux only checks whether address <code>A</code> is sponsored by contract <code>B</code>. If <code>A</code> is sponsored, <code>B</code> will afford all the gas and/or collateral during the transaction execution, including the message call from <code>B</code> to <code>C</code>. In other words, only a transaction sender could be sponsored.  </p><p>The <strong>SponsorControl</strong> contract keeps the following information for each user-established contract:</p><ul><li><code>sponsor_for_gas</code>: this is the account that provides the subsidy for gas consumption;</li><li><code>sponsor_for_collateral</code>: this is the account that provides the subsidy for collateral for storage;</li><li><code>sponsor_balance_for_gas</code>: this is the balance of subsidy available for gas consumption;</li><li><code>sponsor_balance_for_collateral</code>: this is the balance of subsidy available for collateral for storage;</li><li><code>sponsor_limit_for_gas_fee</code>: this is the upper bound for the gas fee subsidy paid for every sponsored transaction;</li><li><code>whitelist</code>: this is the list of normal accounts that are eligible for the subsidy, where a special all-zero address refers to all normal accounts. Only the contract itself and the admin have the authority to change this list.</li></ul><p>There are two resources that can be sponsored: gas consumption and storage collateral.</p><ul><li><em>For gas consumption</em>: If a transaction calls a contract with non-empty <code>sponsor_for_gas</code> and the sender is in the <code>whitelist</code> of the contract and the gas fee specified by the transaction is within the <code>sponsor_limit_for_gas_fee</code>, the gas consumption of the transaction is paid from the <code>sponsor_balance_for_gas</code> of the contract (if it is sufficient) rather than from the sender’s balance, and the execution of the transaction would fail if the <code>sponsor_balance_for_gas</code> cannot afford the gas consumption. Otherwise, the sender should pay for the gas consumption.</li><li><em>For storage collateral</em>: If a transaction calls a contract with non-empty <code>sponsor_balance_for_collateral</code> and the sender is in the <code>whitelist</code> of the contract,  the collateral for storage incurred in the execution of the transaction is deducted from <code>sponsor_balance_for_collateral</code> of the contract, and the owner of those modified storage entries is set to the contract address accordingly. Otherwise, the sender should pay for the collateral for storage incurred in the execution.</li></ul><p>When a contract is created, its <code>sponsor_for_gas</code> and <code>sponsor_for_collateral</code> will be initialized by zero address, and the sponsor balance will be initialized by 0. Both sponsorship for gas and for collateral can be updated by calling the SponsorControl contract. The current sponsor can call this contract to transfer funds to increase the sponsor balances directly, and the current sponsor for gas is also allowed to increase the <code>sponsor_limit_for_gas_fee</code> without transferring new funds. Other normal accounts can replace the current sponsor by calling this contract and providing more funds for sponsorship.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="sponsorship-replacement"></a>Sponsorship Replacement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sponsorship-replacement" title="Direct link to heading">#</a></h2><p>To replace the <code>sponsor_for_gas</code> of a contract, the new sponsor should call function <code>setSponsorForGas(address contractAddr, uint upperBound)</code> and transfer to the internal contract a fund. The following conditions are required to replace sponsor for gas:</p><ol><li>The transferred fund should more than the current <code>sponsor_balance_for_gas</code> of the contract.</li><li>The new value for <code>sponsor_limit_for_gas_fee</code> (specified the <code>upperBound</code> parameter) should be no less than the old sponsor’s limit unless the old <code>sponsor_balance_for_gas</code> cannot afford the old <code>sponsor_limit_for_gas_fee</code>.</li><li>The transferred fund should be &gt;= 1000 times of the new limit, so that it is sufficient to subsidize at least <code>1000</code> transactions calling the contract.</li></ol><p>If the above conditions are satisfied, the remaining <code>sponsor_balance_for_gas</code> will be refunded to the old <code>sponsor_for_gas</code>, and the fund transferred to the internal contract will be added to the <code>sponsor_balance_for_gas</code> of the contract. Then the <code>sponsor_for_gas</code> and <code>sponsor_limit_for_gas_fee</code> will be updated according to the new sponsor’s specification. Otherwise, an exception will be triggered. </p><p>The replacement of <code>sponsor_for_collateral</code> is similar except that there is no analog of the limit for gas fee. The function is <code>setSponsorForCollateral(address contractAddr)</code>. The new sponsor should transfer a fund more than the fund provided by the current sponsor for collateral of the contract. Then the current <code>sponsor_for_collateral</code> will be fully refunded, i.e. the sum of <code>sponsor_balance_for_collateral</code> and the total collateral for storage used by the contract, and both collateral sponsorship fields are changed as the new sponsor’s request accordingly. </p><p>Conflux also allows a contract account to be a sponsor. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="add-sponsor-balance"></a>Add Sponsor Balance<a aria-hidden="true" tabindex="-1" class="hash-link" href="#add-sponsor-balance" title="Direct link to heading">#</a></h2><p>The sponsor can provide additional sponsor balance without sponsorship replacement. In this case, the sponsor should also interact with function <code>setSponsorForGas(address contractAddr, uint upperBound)</code> or <code>setSponsorForCollateral(address contractAddr)</code>, and meet all the requirements except condition 1. If requirements are satisfied, the transferred fund will be added to sponsor balance and the <code>sponsor_limit_for_gas_fee</code> will be updated accordingly.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="whitelist-maintenance"></a>Whitelist maintenance<a aria-hidden="true" tabindex="-1" class="hash-link" href="#whitelist-maintenance" title="Direct link to heading">#</a></h2><p>Only the contract itself or contract admin can update the contract whitelist. The sponsors have no rights for changing whitelist. </p><p>A contract can call function <code>addPrivilege(address[] memory)</code> to any addresses to the whitelist. It means that if the <code>sponsor_for_gas</code> is set, the contract will pay the gas fee for the accounts in the whitelist, and if the <code>sponsor_for_collateral</code> is set, the contract will pay the CFS (collateral for storage) for the accounts in the whitelist. The zero address is a special address <code>0x0000000000000000000000000000000000000000</code>. If this address is added to whitelist, all the transactions calling this contract will be sponsored. A contract can call this function <code>removePrivilege(address[] memory)</code> to remove some normal account address from the whitelist. Remove a non-existent address will not cause an error or exception. </p><p><strong>Corner cases:</strong></p><ol><li>A contract address can also be added to the whitelist, but it is meaningless because only the transaction sender could be sponsored. </li></ol><p>The admin of a contract can use the interfaces <code>addPrivilegeByAdmin(address contractAddr, address[] memory addresses)</code> and <code>removePrivilegeByAdmin(address contractAddr, address[] memory addresses)</code> to maintain the whitelist.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="examples-1"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples-1" title="Direct link to heading">#</a></h2><p>Suppose you have a simple contract like this.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-solidity codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity &gt;=0.4.15;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &quot;https://github.com/Conflux-Chain/conflux-rust/blob/master/internal_contract/contracts/SponsorWhitelistControl.sol&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">contract CommissionPrivilegeTest {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mapping(uint =&gt; uint) public ss;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function add(address account) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x0888000000000000000000000000000000000001);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address[] memory a = new address[](1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a[0] = account;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cpc.addPrivilege(a);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function remove(address account) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SponsorWhitelistControl cpc = SponsorWhitelistControl(0x0888000000000000000000000000000000000001);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        address[] memory a = new address[](1);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a[0] = account;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        cpc.removePrivilege(a);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function foo() public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    function par_add(uint start, uint end) public payable {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for (uint i = start; i &lt; end; i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ss[i] = 1;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>After deploying the contract and the address is <code>contract_addr</code>, if someone wants to sponsor the gas consumption, he/she can send a transaction like below:</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://test.confluxrpc.org&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">wallet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addPrivateKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> sponsor_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">InternalContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;SponsorWhitelistControl&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sponsor_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setSponsorForGas</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">contract_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> your_upper_bound</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> your_sponsor_value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>As for sponsor the storage collateral, you can simply replace the function <code>setSponsorForGas(contract_addr, your_upper_bound)</code> to <code>setSponsorForCollateral(contract_addr)</code>.</p><p>After that you can maintain the <code>whitelist</code> for your contract using <code>addPrivilege</code> and <code>removePrivilege</code>. The special address <code>0x0000000000000000000000000000000000000000</code> with all zeros means everyone is in the <code>whitelist</code>. You need to use it carefully.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">you_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">white_list_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">you_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">white_list_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>After that the accounts in <code>whiltelist</code> will pay nothing while calling <code>you_contract.foo()</code> or <code>you_contract.par_add(1, 10)</code>.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="staking-contract"></a>Staking Contract<a aria-hidden="true" tabindex="-1" class="hash-link" href="#staking-contract" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="overview-2"></a>Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview-2" title="Direct link to heading">#</a></h2><p>Conflux introduces the staking mechanism for two reasons: first, staking mechanism provides a better way to charge the occupation of storage space (comparing to “pay once, occupy forever”); and second, this mechanism also helps in defining the voting power in decentralized governance.</p><p>At a high level, Conflux implements a built-in <strong>Staking</strong> contract to record the staking information of all accounts, for both normal addresses and smart contracts. By sending a transaction to this contract, users (both external users and smart contracts) can deposit/withdraw funds, which is also called stakes in the contract. The interest of staked funds is issued at withdrawal, and depends on both the amount and staking period of the fund being withdrawn.</p><p>A user (or a contract) can deposit balance for staking by calling <code>deposit(uint amount)</code> and then <code>amount</code> Drip will be moved from its <code>balance</code> to <code>stakingBalance</code>. Notice that this function is non-payable, the user only needs to specify the amount to be staked without transferring any funds to internal contract.</p><p>The user can also withdraw balance by <code>withdraw(uint amount)</code>. The caller can call this function to withdraw some tokens from the Conflux Internal Staking Contract. This will also trigger interest settlement. The staking capital and staking interest will be transferred to the user&#x27;s balance in time. All the withdrawal applications will be processed on a first-come-first-served basis according to the sequence of staking orders.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="interest-rate"></a>Interest Rate<a aria-hidden="true" tabindex="-1" class="hash-link" href="#interest-rate" title="Direct link to heading">#</a></h2><p>The annualized staking interest rate is currently set to 4.08%. Compound interest is implemented in the granularity of blocks.</p><p>When executing a transaction sent by account <code>addr</code> at block <code>B</code> to withdraw a fund of value <code>v</code> deposited at block <code>B&#x27;</code>, the interest is calculated as follows:</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">interest issued = v * (1 + 4% / 63072000)^T - v</span></div></div></div></div></div><p>where <code>T = BlockNo(B)−BlockNo(B&#x27;)</code> is the staking period measured by the number of blocks, and <code>63072000</code> is the expected number of blocks generated in <code>365</code> days with the target block time <code>0.5</code> seconds.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="locking-and-voting-power"></a>Locking and Voting Power<a aria-hidden="true" tabindex="-1" class="hash-link" href="#locking-and-voting-power" title="Direct link to heading">#</a></h2><p>By locking the staking balance, the user can obtain <em>vote power</em> for further on-chain governance. With function <code>voteLock(uint amount, uint unlock_block_number)</code>, the account makes a promise that This process resembles making promise that &quot;My <code>stakingBalance</code> will always have at least <code>amount</code> Drip in the next <code>unlock_block_number</code>&quot;. The account can make multiple promises, like &quot;I will always at least 10 CFX in this year, and then always stake at least 5 CFX in the next year.&quot;  <strong>Once the promise has been made, there is no way to cancel it!</strong> But the account can overwrite old promise by locking more balance. Whenever the account tries to withdraw <code>stakingBalance</code>, the internal contract will check whether the rest balance matches the locking promise. </p><p>Here we introduce the detailed logic for locking balance by illustrating several examples. Suppose Conflux will generate about <code>x</code> blocks in the rest of this year and <code>y</code> blocks in the next year. Since Conflux generates two block per second, <code>y</code> approximately equals to <code>2 * 60 * 60 * 24 * 365</code>. And the value of <code>x</code> depends on when you read this article. </p><ol><li>If an account has 10 CFX in <code>stakingBalance</code>, if it calls <code>voteLock(100 * 10^18, x)</code>, then the transaction will  fail because this account tries to lock 100 CFX but it doesn&#x27;t have enough <code>stakingBalance</code>.   </li><li>However, if this account calls <code>voteLock(8 * 10^18, x)</code>, then the transaction will success.</li><li>After that, if this account calls <code>voteLock(6 * 10^18, x+y)</code>, then the transaction will also success. It means that 2 CFX will be unlocked at the end of this year, and another 6 CFX will be locked at the end of next year. </li><li>Then, if this account calls <code>voteLock(0, x)</code>, nothing will happen. The transaction will not trigger an error during execution. The internal contract will regard this call as a meaningless promise: the account will has at least 0 CFX in <code>stakingBalance</code>, while the old promises made in step 2 and step 3 will still hold.</li><li>If this account calls <code>voteLock(9 * 10^18, x+y)</code>, the old two promises will be overwritten because &quot;locking 9 CFX until the end of the next year is a stronger promise&quot;.</li></ol><p>Locking does not have any influence on the stake interest. When the account withdraw staking balance successfully, the staking interest will be computed as usual. </p><p>At any time, each locked Drip will be assigned a <em>vote power</em> from 0 to 1 according to its unlock time. The Drip to be unlocked in more than one year will have a full vote power. See section 8.3.2 in the <a href="https://conflux-protocol.s3-ap-southeast-1.amazonaws.com/tech-specification.pdf">Conflux Protocol Specification</a> for more details.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="examples-2"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples-2" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0xxxxxxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> cfx </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Conflux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;http://test.confluxrpc.org&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">wallet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addPrivateKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">PRIVATE_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create account instance</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> staking_contract </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cfx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">InternalContract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Staking&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// deposit some amount of tokens</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">deposit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// withdraw some amount of tokens</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">withdraw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// lock some tokens until some block number</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">staking_contract</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">voteLock</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_number_of_tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> your_unlock_block_number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">sendTransaction</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword module" style="font-style:italic">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Conflux-Chain/conflux-rust/edit/master/internal_contract/README.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-01-08T12:04:12.000Z" class="docLastUpdatedAt_2pXX">1/8/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/conflux-doc/docs/independent_chain"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Run an Independent Chain</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/conflux-doc/docs/light_node"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Run a Light Node »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_1Fsi"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a></li><li><a href="#overview-1" class="table-of-contents__link">Overview</a></li><li><a href="#sponsorship-replacement" class="table-of-contents__link">Sponsorship Replacement</a></li><li><a href="#add-sponsor-balance" class="table-of-contents__link">Add Sponsor Balance</a></li><li><a href="#whitelist-maintenance" class="table-of-contents__link">Whitelist maintenance</a></li><li><a href="#examples-1" class="table-of-contents__link">Examples</a></li><li><a href="#overview-2" class="table-of-contents__link">Overview</a></li><li><a href="#interest-rate" class="table-of-contents__link">Interest Rate</a></li><li><a href="#locking-and-voting-power" class="table-of-contents__link">Locking and Voting Power</a></li><li><a href="#examples-2" class="table-of-contents__link">Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/en/conflux_overview">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/conflux-portal/docs/en/portal/introduction">Portal</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://bounty.conflux-chain.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bounty</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Conflux-Chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/Conflux_Network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 Conflux Chain, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.3cee6932.js"></script>
<script src="/runtime~main.3c1408f1.js"></script>
<script src="/main.258f3ebe.js"></script>
<script src="/1.5ccf34a3.js"></script>
<script src="/2.19bdff5a.js"></script>
<script src="/69.c9038b7d.js"></script>
<script src="/76.bd9a6ce5.js"></script>
<script src="/20ac7829.f718cc52.js"></script>
<script src="/73.5e6ca28b.js"></script>
</body>
</html>