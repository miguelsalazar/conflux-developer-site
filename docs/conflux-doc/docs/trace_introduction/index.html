<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">trace_introduction | Conflux</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="trace_introduction | Conflux"><meta data-react-helmet="true" name="description" content="Introduction to Transaction Traces"><meta data-react-helmet="true" property="og:description" content="Introduction to Transaction Traces"><meta data-react-helmet="true" property="og:url" content="https://developer.conflux-chain.org/docs/conflux-doc/docs/trace_introduction"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://developer.conflux-chain.org/docs/conflux-doc/docs/trace_introduction"><link rel="stylesheet" href="/styles.72ea3a70.css">
<link rel="preload" href="/styles.d968a4af.js" as="script">
<link rel="preload" href="/runtime~main.bba1c54e.js" as="script">
<link rel="preload" href="/main.87571851.js" as="script">
<link rel="preload" href="/1.682dd8ae.js" as="script">
<link rel="preload" href="/2.23ae6c82.js" as="script">
<link rel="preload" href="/73.9b1f4a38.js" as="script">
<link rel="preload" href="/82.4f12db53.js" as="script">
<link rel="preload" href="/20ac7829.cd704df0.js" as="script">
<link rel="preload" href="/473ac162.bccd3c24.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Conflux-Chain/conflux-developer-site" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_KVdu"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_13On moon_3n_g"></span></div><div class="react-toggle-track-x"><span class="toggle_13On sun_UemI"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Conflux Logo"><strong class="navbar__title">Conflux Developer</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/Conflux-Chain/conflux-developer-site" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_3T5V"><main class="docMainContainer_2yiU"><div class="container padding-vert--lg docItemWrapper_182k"><div class="row"><div class="col docItemCol_2uRP"><div class="docItemContainer_1gVo"><article><header><h1 class="docTitle_3r6L">trace_introduction</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="introduction-to-transaction-traces"></a>Introduction to Transaction Traces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introduction-to-transaction-traces" title="Direct link to heading">#</a></h1><p>Traces are used to record the transaction execution details. It can be used to debug or retrieve more information (like getting contract addresses created within transaction execution).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="trace-types"></a>Trace Types<a aria-hidden="true" tabindex="-1" class="hash-link" href="#trace-types" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="call"></a>Call<a aria-hidden="true" tabindex="-1" class="hash-link" href="#call" title="Direct link to heading">#</a></h3><p>The trace is recorded for all <code>Call</code> operations, including balance transferring or contract calling, executed either by the transaction itself or inside a contract.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Call {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The sending account.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub from: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The destination account.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub to: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The value transferred to the destination account.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub value: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The gas available for executing the call.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub gas: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The input data provided to the call.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub input: Bytes,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The type of the call.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub call_type: CallType,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum CallType {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Not a CALL.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// CALL.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Call,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// CALLCODE.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    CallCode,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// DELEGATECALL.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DelegateCall,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// STATICCALL</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    StaticCall,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>If a transaction itself is calling a contract (<code>to</code> is a contract address), this trace will always be the first one in the trace list of this transaction.</p><p><code>call_type</code> can never be <code>None</code> for <code>Call</code> traces.</p><p>Note that <code>gas</code> is the &quot;provided&quot; gas for the execution of the callee, so the gas overhead has been deducted. For example, it is <code>0</code> for a simple balance transferring transaction of <code>21000</code> gas, because the base gas cost (<code>21000</code>) has been deducted in advance. The gas cost for call-related opcodes (<code>CALL</code>, <code>DELEGATECALL</code>, e.t.c.) or the 1/64 gas reserve for calling are also deducted in advance during contract execution.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="callresult"></a>CallResult<a aria-hidden="true" tabindex="-1" class="hash-link" href="#callresult" title="Direct link to heading">#</a></h3><p>The trace is recorded after a <code>Call</code> operation finishes.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct CallResult {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The outcome of the result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub outcome: Outcome,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The amount of gas left</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub gas_left: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Output data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub return_data: Bytes,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub enum Outcome {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Success,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Reverted,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Fail,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Note that there is no <code>CallResult</code> for simple transfer transactions, and the information is accesible in the transaction receipts in this case.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="create"></a>Create<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create" title="Direct link to heading">#</a></h3><p>The trace is recorded for all operations that create contracts, including executing contract creation transactions or successfully executing the <code>CREATE</code>/<code>CREATE2</code> opcode.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Create {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The address of the creator.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub from: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The value with which the new account is endowed.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub value: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The gas available for the creation init code.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub gas: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The init code.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub init: Bytes,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Similar to <code>Call</code>, the <code>gas</code> is the &quot;provided&quot; gas for the <code>Create</code> operation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="createresult"></a>CreateResult<a aria-hidden="true" tabindex="-1" class="hash-link" href="#createresult" title="Direct link to heading">#</a></h3><p>The trace is recorded after a <code>Create</code> operation finishes.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct CreateResult {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The outcome of the create</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub outcome: Outcome,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The created contract address</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub addr: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The amount of gas left</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub gas_left: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Output data</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub return_data: Bytes,</span></div></div></div></div></div><p>Similar to <code>CallResult</code>, no <code>CreateResult</code> trace is recorded for the one triggered by the original contract creation transactions. Note that other contracts created during the creation of the original contract still have traces.  </p><p><code>addr</code> can only be used if <code>outcome</code> is <code>Success</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="internaltransferaction"></a>InternalTransferAction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#internaltransferaction" title="Direct link to heading">#</a></h3><p>The trace is recorded for the balance transfer triggered by internal contracts. It includes contract suicide, sponsor replacement (including storage collateral sponsor and gas sponsor) , and staking.</p><div class="mdxCodeBlock_1P0T"><div class="codeBlockContent_2jYE"><button type="button" aria-label="Copy code to clipboard" class="copyButton_140E">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3QFk"><div class="codeBlockLines_f66M" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct InternalTransferAction {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The source address. If it is zero, then it is an interest mint action.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub from: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The destination address. If it is zero, then it is a burnt action.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub to: Address,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The amount of CFX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub value: U256,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>For contract suicide, if the refund address is the to-be-destroyed contract , the refund balance will be burnt, so <code>to</code> will be the null address instead of the refund address.</p><p>For sponsor replacement, <code>from</code> is set to the sponsor whitelist contract address (<code>0x0888000000000000000000000000000000000001</code>, i.e., <code>cfx:aaejuaaaaaaaaaaaaaaaaaaaaaaaaaaaaegg2r16ar</code>).</p><p>For staking deposit, <code>to</code> is set to the staking interest contract address (<code>0x0888000000000000000000000000000000000002</code>, i.e., <code>cfx:aaejuaaaaaaaaaaaaaaaaaaaaaaaaaaaajrwuc9jnb</code>).</p><p>For staking withdraw, two <code>InternalTransferAction</code> traces will be recorded. The first is for withdrawing the original staked balance (<code>from</code> is set to the staking interest contract address), and the second is for withdrawing the staking interest (<code>from</code> is set to the null address).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_25AA" id="discussion-of-failure"></a>Discussion of Failure<a aria-hidden="true" tabindex="-1" class="hash-link" href="#discussion-of-failure" title="Direct link to heading">#</a></h2><p>For <code>Call</code> or <code>Create</code> executed within contract execution, it is only recorded after the actual trap is triggered during execution, and the result is recorded after the trap is processed. If the transaction/instruction fails without triggering the trap (for example, the sender does not have enough balance, reentrancy is detected, or the stack has reached the max depth), no trace will be recorded.</p><p>For <code>Call</code> or <code>Create</code> triggered by the original transaction, the trace is only recorded after passing the preliminary checks. First, traces will only be recorded for &quot;executed&quot; transactions, so if the nonce does not match, this transaction will not be executed and there will be no trace. If the transaction is executed (the nonce of the sender increases), but the sender does not have enough balance to execute the transactions, there are also no traces. For <code>Create</code>, if the to-be-created contract address was created before and has code, we will also return directly without recording traces. </p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Conflux-Chain/conflux-developer-site/edit/master/docs/conflux-doc/docs/trace_introduction.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-03-31T09:14:36.000Z" class="docLastUpdatedAt_2pXX">3/31/2021</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_1Fsi"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#trace-types" class="table-of-contents__link">Trace Types</a><ul><li><a href="#call" class="table-of-contents__link">Call</a></li><li><a href="#callresult" class="table-of-contents__link">CallResult</a></li><li><a href="#create" class="table-of-contents__link">Create</a></li><li><a href="#createresult" class="table-of-contents__link">CreateResult</a></li><li><a href="#internaltransferaction" class="table-of-contents__link">InternalTransferAction</a></li></ul></li><li><a href="#discussion-of-failure" class="table-of-contents__link">Discussion of Failure</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/en/conflux_overview">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/conflux-portal/docs/en/portal/introduction">Portal</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://bounty.conflux-chain.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bounty</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Conflux-Chain" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://twitter.com/Conflux_Network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="text--center"><div>© 2021 Conflux. All Rights Reserved.</div></div></div></footer></div>
<script src="/styles.d968a4af.js"></script>
<script src="/runtime~main.bba1c54e.js"></script>
<script src="/main.87571851.js"></script>
<script src="/1.682dd8ae.js"></script>
<script src="/2.23ae6c82.js"></script>
<script src="/73.9b1f4a38.js"></script>
<script src="/82.4f12db53.js"></script>
<script src="/20ac7829.cd704df0.js"></script>
<script src="/473ac162.bccd3c24.js"></script>
</body>
</html>